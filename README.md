# æ™ºèƒ½å……ç”µæ¡©ç³»ç»Ÿ (Smart Charging Station System)

## ğŸ“– é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºLinuxçš„æ™ºèƒ½å……ç”µæ¡©ç®¡ç†ç³»ç»Ÿï¼Œä½¿ç”¨LVGLå›¾å½¢åº“æ„å»ºç”¨æˆ·ç•Œé¢ï¼Œæ”¯æŒè§¦æ‘¸å±æ“ä½œã€‚ç³»ç»Ÿå®ç°äº†ç”¨æˆ·è®¤è¯ã€å……ç”µç®¡ç†ã€æ”¯ä»˜ç»“ç®—ã€å•†å®¶ç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œé€‚ç”¨äºæ–°èƒ½æºæ±½è½¦å……ç”µæ¡©çš„å•†ä¸šåŒ–è¿è¥ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- ğŸ¨ **ç°ä»£åŒ–UIç•Œé¢**: åŸºäºLVGL 9.1.0å›¾å½¢åº“ï¼Œæ”¯æŒè§¦æ‘¸å±æ“ä½œ
- ğŸ‘¥ **åŒç”¨æˆ·ç³»ç»Ÿ**: æ”¯æŒé¡¾å®¢å’Œå•†å®¶ä¸¤ç§ç”¨æˆ·ç±»å‹
- ğŸ”‹ **æ™ºèƒ½å……ç”µç®¡ç†**: æ”¯æŒå¿«å……/æ…¢å……æ¨¡å¼ï¼Œå®æ—¶ç›‘æ§å……ç”µçŠ¶æ€
- ğŸ’° **å¤šæ ·åŒ–æ”¯ä»˜**: æ”¯æŒå¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®ã€é’±åŒ…ä½™é¢æ”¯ä»˜
- ğŸ–¥ï¸ **å•†å®¶æ§åˆ¶å°**: æä¾›ç”¨æˆ·ç®¡ç†ã€ä½™é¢æ“ä½œç­‰ç®¡ç†åŠŸèƒ½
- ğŸ“Š **å®æ—¶æ•°æ®ç›‘æ§**: æ˜¾ç¤ºåŠŸç‡ã€ç”µæµã€ç”µå‹ç­‰å……ç”µå‚æ•°
- ğŸ” **å®‰å…¨è®¤è¯**: åŸºäºæ–‡ä»¶çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæŠ€æœ¯
- **GUIæ¡†æ¶**: LVGL 9.1.0 - è½»é‡çº§åµŒå…¥å¼å›¾å½¢åº“
- **å¼€å‘è¯­è¨€**: Cè¯­è¨€
- **æ„å»ºç³»ç»Ÿ**: Makefile
- **ç›®æ ‡å¹³å°**: Linux (æ”¯æŒARMäº¤å‰ç¼–è¯‘)

### å›¾å½¢åç«¯æ”¯æŒ
- **Linux Framebuffer (fbdev)**: ç›´æ¥è®¿é—®å¸§ç¼“å†²è®¾å¤‡
- **DRM/KMS**: ç°ä»£Linuxå›¾å½¢æ˜¾ç¤ºæ ˆ
- **SDL2**: è·¨å¹³å°å¤šåª’ä½“åº“(ç”¨äºå¼€å‘è°ƒè¯•)

### è¾“å…¥è®¾å¤‡æ”¯æŒ
- **Evdev**: Linuxäº‹ä»¶è®¾å¤‡æ¥å£ï¼Œæ”¯æŒè§¦æ‘¸å±
- **é”®ç›˜/é¼ æ ‡**: é€šè¿‡evdevæˆ–SDL2æ”¯æŒ

### ç³»ç»Ÿç»„ä»¶
- **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ**: åŸºäºæ–‡ä»¶çš„ç”¨æˆ·ç®¡ç†
- **å……ç”µç®¡ç†ç³»ç»Ÿ**: å®æ—¶å……ç”µçŠ¶æ€ç›‘æ§å’Œæ§åˆ¶
- **å•†å®¶æ§åˆ¶å°**: ç»ˆç«¯å‘½ä»¤è¡Œç®¡ç†ç•Œé¢
- **æ”¯ä»˜ç³»ç»Ÿ**: å¤šç§æ”¯ä»˜æ–¹å¼é›†æˆ

## ğŸ“ é¡¹ç›®ç»“æ„

```
lv_port_linux/
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ main.c                       # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ lv_conf.h                    # LVGLé…ç½®æ–‡ä»¶
â”œâ”€â”€ Makefile                     # æ„å»ºé…ç½®
â”œâ”€â”€ check_touch.sh               # è§¦æ‘¸è®¾å¤‡è¯Šæ–­è„šæœ¬
â”œâ”€â”€ customer_users.txt           # é¡¾å®¢ç”¨æˆ·æ•°æ®
â”œâ”€â”€ merchant_users.txt           # å•†å®¶ç”¨æˆ·æ•°æ®
â”œâ”€â”€ src/                         # ä¸šåŠ¡é€»è¾‘æ¨¡å—
â”‚   â”œâ”€â”€ user_auth.c/.h          # ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
â”‚   â”œâ”€â”€ charging_system.c/.h    # å……ç”µç®¡ç†ç³»ç»Ÿ
â”‚   â””â”€â”€ merchant_console.c/.h   # å•†å®¶æ§åˆ¶å°
â”œâ”€â”€ ui/                          # ç”¨æˆ·ç•Œé¢æ¨¡å—
â”‚   â”œâ”€â”€ ui.c/.h                 # UIä¸»æ–‡ä»¶
â”‚   â”œâ”€â”€ ui_events.h             # UIäº‹ä»¶å¤„ç†
â”‚   â”œâ”€â”€ ui_helpers.c/.h         # UIè¾…åŠ©å‡½æ•°
â”‚   â”œâ”€â”€ screens/                # ç•Œé¢å±å¹•
â”‚   â”‚   â”œâ”€â”€ ui_Screen1.c        # ä¸»ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ ui_Screen2.c        # ç”¨æˆ·é€‰æ‹©ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ ui_Screen3.c        # ç™»å½•ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ ui_Screen4.c        # æ³¨å†Œç•Œé¢
â”‚   â”‚   â”œâ”€â”€ ui_Screen5.c        # å……ç”µæ¨¡å¼é€‰æ‹©
â”‚   â”‚   â”œâ”€â”€ ui_Screen6.c        # å……ç”µè¿›è¡Œç•Œé¢
â”‚   â”‚   â”œâ”€â”€ ui_Screen7.c        # ç»“ç®—ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ ui_Screen8.c        # æ”¯ä»˜æ–¹å¼é€‰æ‹©
â”‚   â”‚   â”œâ”€â”€ ui_Screen9.c        # æ”¯ä»˜å®Œæˆç•Œé¢
â”‚   â”‚   â”œâ”€â”€ ui_Screen10.c       # é¡¾å®¢ä¸»ç•Œé¢
â”‚   â”‚   â””â”€â”€ ui_Screen11.c       # å•†å®¶ç®¡ç†ç•Œé¢
â”‚   â”œâ”€â”€ components/             # UIç»„ä»¶
â”‚   â”œâ”€â”€ fonts/                  # å­—ä½“æ–‡ä»¶
â”‚   â””â”€â”€ images/                 # å›¾ç‰‡èµ„æº
â”œâ”€â”€ lvgl/                       # LVGLå›¾å½¢åº“
â””â”€â”€ build/                      # æ„å»ºè¾“å‡ºç›®å½•
```

## ğŸ”„ ç³»ç»Ÿæµç¨‹

### 1. å¯åŠ¨æµç¨‹
```
ç³»ç»Ÿåˆå§‹åŒ– â†’ å›¾å½¢è®¾å¤‡åˆå§‹åŒ– â†’ è§¦æ‘¸è®¾å¤‡é…ç½® â†’ ç”¨æˆ·è®¤è¯ç³»ç»Ÿåˆå§‹åŒ– â†’ å……ç”µç³»ç»Ÿåˆå§‹åŒ– â†’ UIç•Œé¢å¯åŠ¨
```

### 2. ç”¨æˆ·ä½¿ç”¨æµç¨‹

#### é¡¾å®¢ä½¿ç”¨æµç¨‹
```
ä¸»ç•Œé¢ â†’ é€‰æ‹©ç”¨æˆ·ç±»å‹(é¡¾å®¢) â†’ ç™»å½•/æ³¨å†Œ â†’ é¡¾å®¢ä¸»ç•Œé¢ â†’ é€‰æ‹©å……ç”µæ¨¡å¼ â†’ å¼€å§‹å……ç”µ â†’ å……ç”µç›‘æ§ â†’ ç»“ç®— â†’ é€‰æ‹©æ”¯ä»˜æ–¹å¼ â†’ æ”¯ä»˜å®Œæˆ
```

#### å•†å®¶ç®¡ç†æµç¨‹
```
ä¸»ç•Œé¢ â†’ é€‰æ‹©ç”¨æˆ·ç±»å‹(å•†å®¶) â†’ å•†å®¶ç™»å½• â†’ å•†å®¶ç®¡ç†ç•Œé¢ â†’ æ§åˆ¶å°æ“ä½œ(æŸ¥çœ‹ç”¨æˆ·ã€ç®¡ç†ä½™é¢ç­‰)
```

### 3. å•†å®¶æ§åˆ¶å°å‘½ä»¤
- `help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
- `list` - æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯
- `balance <ç”¨æˆ·å>` - æŸ¥çœ‹æŒ‡å®šç”¨æˆ·ä½™é¢
- `set <ç”¨æˆ·å> <é‡‘é¢>` - è®¾ç½®ç”¨æˆ·ä½™é¢
- `add <ç”¨æˆ·å> <é‡‘é¢>` - ä¸ºç”¨æˆ·å……å€¼
- `exit` - é€€å‡ºæ§åˆ¶å°

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Linuxæ“ä½œç³»ç»Ÿ (æ¨èUbuntu 18.04+)
- GCCç¼–è¯‘å™¨æˆ–ARMäº¤å‰ç¼–è¯‘å·¥å…·é“¾
- æ”¯æŒFramebufferçš„æ˜¾ç¤ºè®¾å¤‡
- è§¦æ‘¸å±è®¾å¤‡ (å¯é€‰)

### ç¼–è¯‘å®‰è£…

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd lv_port_linux
```

2. **å®‰è£…ä¾èµ–** (å¦‚æœä½¿ç”¨SDL2åç«¯)
```bash
sudo apt-get update
sudo apt-get install libsdl2-dev
```

3. **é…ç½®å›¾å½¢åç«¯** (å¯é€‰)
ç¼–è¾‘ `lv_conf.h` æ–‡ä»¶ï¼š
- ä½¿ç”¨Framebuffer: `#define LV_USE_LINUX_FBDEV 1`
- ä½¿ç”¨SDL2: `#define LV_USE_SDL 1`

4. **ç¼–è¯‘é¡¹ç›®**
```bash
# æœ¬åœ°ç¼–è¯‘
make clean && make

# ARMäº¤å‰ç¼–è¯‘ (éœ€è¦é…ç½®äº¤å‰ç¼–è¯‘å·¥å…·é“¾)
make clean && make CC=arm-linux-gnueabihf-gcc
```

5. **è¿è¡Œç¨‹åº**
```bash
# éœ€è¦rootæƒé™è®¿é—®è®¾å¤‡èŠ‚ç‚¹
sudo ./build/bin/main
```

### è®¾å¤‡é…ç½®

1. **è§¦æ‘¸å±é…ç½®**
- ç¡®ä¿è§¦æ‘¸è®¾å¤‡åœ¨ `/dev/input/eventX` ä¸‹å¯ç”¨
- è¿è¡Œè¯Šæ–­è„šæœ¬æ£€æŸ¥è®¾å¤‡çŠ¶æ€ï¼š
```bash
chmod +x check_touch.sh
./check_touch.sh
```

2. **å±å¹•åˆ†è¾¨ç‡é…ç½®**
- åœ¨ `main.c` ä¸­è°ƒæ•´æ ¡å‡†å‚æ•°ï¼š
```c
lv_evdev_set_calibration(touch, 0, 0, 800, 480); // æ ¹æ®å®é™…å±å¹•å°ºå¯¸è°ƒæ•´
```

3. **ç”¨æˆ·æ•°æ®åˆå§‹åŒ–**
- ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºé»˜è®¤ç”¨æˆ·æ–‡ä»¶
- é»˜è®¤å•†å®¶è´¦å·: `666666/666666`

## ğŸ”§ é…ç½®è¯´æ˜

### LVGLé…ç½® (`lv_conf.h`)
- `LV_COLOR_DEPTH`: é¢œè‰²æ·±åº¦è®¾ç½®
- `LV_USE_LINUX_FBDEV`: å¯ç”¨Linux Framebufferæ”¯æŒ
- `LV_USE_EVDEV`: å¯ç”¨evdevè¾“å…¥è®¾å¤‡æ”¯æŒ
- `LV_USE_FREETYPE`: å­—ä½“æ¸²æŸ“æ”¯æŒ (å·²ç¦ç”¨ä»¥å‡å°‘ä¾èµ–)

### ç³»ç»Ÿå‚æ•°
- å……ç”µåŠŸç‡èŒƒå›´: 7kW - 120kW (å¯åœ¨ä»£ç ä¸­è°ƒæ•´)
- å……ç”µè´¹ç‡: 1.5å…ƒ/kWh
- æ”¯æŒçš„æ”¯ä»˜æ–¹å¼: å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®ã€é’±åŒ…ä½™é¢

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è§¦æ‘¸ä¸å“åº”**
   - æ£€æŸ¥è®¾å¤‡æƒé™: `ls -la /dev/input/event*`
   - ä½¿ç”¨ `evtest` å·¥å…·æµ‹è¯•è§¦æ‘¸è®¾å¤‡
   - ç¡®è®¤è§¦æ‘¸æ ¡å‡†å‚æ•°æ­£ç¡®

2. **ç¼–è¯‘é”™è¯¯**
   - æ£€æŸ¥æ˜¯å¦å®‰è£…äº†å¿…è¦çš„å¼€å‘åº“
   - ç¡®è®¤äº¤å‰ç¼–è¯‘å·¥å…·é“¾é…ç½®æ­£ç¡®
   - æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯è°ƒæ•´é…ç½®

3. **ç•Œé¢æ˜¾ç¤ºå¼‚å¸¸**
   - æ£€æŸ¥framebufferè®¾å¤‡: `ls -la /dev/fb*`
   - ç¡®è®¤å±å¹•åˆ†è¾¨ç‡é…ç½®
   - æ£€æŸ¥LVGLé…ç½®å‚æ•°

### è°ƒè¯•æŠ€å·§
- å¯ç”¨LVGLæ—¥å¿—è¾“å‡ºæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
- ä½¿ç”¨ `printf` æ·»åŠ è°ƒè¯•ä¿¡æ¯
- æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—: `dmesg | grep input`

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›é¡¹ç›®ï¼

1. Forkæœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»ºPull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäºMITè®¸å¯è¯å¼€æº - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [LVGL](https://lvgl.io/) - ä¼˜ç§€çš„åµŒå…¥å¼å›¾å½¢åº“
- [lv_port_linux](https://github.com/lvgl/lv_port_linux) - Linuxç§»æ¤åŸºç¡€æ¡†æ¶

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤Issue: [GitHub Issues](https://github.com/your-repo/issues)

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStaræ”¯æŒä¸€ä¸‹ï¼

```
mkdir build
cd build 
cmake ..
make -j
```

### Makefile

```
make -j
```

## Environment variables

Environment variables can be set to modify behavior of the demo.
The following variables are supported.

### Legacy framebuffer (fbdev)

- `LV_LINUX_FBDEV_DEVICE` - override default (`/dev/fb0`) framebuffer device node.

### DRM/KMS

- `LV_LINUX_DRM_CARD` - override default (`/dev/dri/card0`) card.

### SDL2

- `LV_SDL_VIDEO_WIDTH` - width of SDL2 surface (default `800`).
- `LV_SDL_VIDEO_HEIGHT` - height of SDL2 surface (default `480`).

## Run the demo application

### As root

Normal users don't have access to `/dev/fb0` so use `sudo` (or see below) : 

cmake:
```
cd ../bin
sudo main
```

Makefile:
```
cd build/bin/
sudo main
```

### Userland

You can give a normal user access to the framebuffer by adding them to the `video` group : 


cmake:
```
sudo adduser $USER video
newgrp video
cd ../bin
./main
```

Makefile:
```
sudo adduser $USER video
newgrp video
cd build/bin/
./main
```
